{"version":3,"sources":["../../src/mixins/callbackify.ts"],"names":[],"mappings":"wGAAA,wD;;;;;;;AAOA;;AAEA;;;;;;;;;;;;AAYO,IAAI,WAAW,GAAG,UAAS,MAAT,EAA0B,OAIlD;;;;AAAG,EAJqB,EAIL;AAClB,kBAAE,QAAF,CAAW,OAAX,EAAoB;AAClB,IAAA,aAAa,EAAE,KADG;AAElB,IAAA,eAAe,EAAE,IAFC;AAGlB,IAAA,YAAY,EAAE,KAHI,EAApB;;;AAMA,MAAI,EAAE,GAAG,UAAS,GAAG,IAAZ,EAAwB;AAC/B,QAAI,YAAJ;AACA,QAAI,OAAO,CAAC,aAAZ,EAA2B;AACzB,MAAA,YAAY,GAAG,gBAAE,IAAF,CAAO,IAAP,CAAf;AACA,UAAI,CAAC,OAAO,CAAC,YAAb,EAA2B;AACzB,QAAA,IAAI,CAAC,KAAL;AACD;AACF,KALD,MAKO;AACL,MAAA,YAAY,GAAG,gBAAE,IAAF,CAAO,IAAP,CAAf;AACA,UAAI,CAAC,OAAO,CAAC,YAAb,EAA2B;AACzB,QAAA,IAAI,CAAC,GAAL;AACD;AACF;AACD,QAAI,QAAQ,GAAG,CAAC,GAAG,IAAJ,KAAmB;AAChC;AACA,MAAA,OAAO,CAAC,KAAR,CAAc,YAAd,EAA4B,IAA5B,EAAkC,IAAlC;AACA;AACD,KAJD;;AAMA,QAAI,YAAY,GAAG,UAAS,MAAT,EAAuB;AACxC,UAAI,OAAO,CAAC,eAAZ,EAA6B;AAC3B,QAAA,UAAU,CAAC,QAAD,EAAW,CAAX,EAAc,SAAd,EAAyB,MAAzB,CAAV;AACD,OAFD,MAEO;AACL,QAAA,UAAU,CAAC,QAAD,EAAW,CAAX,EAAc,MAAd,CAAV;AACD;AACF,KAND;;AAQA,QAAI,UAAU,GAAG,UAAS,GAAT,EAAoB;AACnC,UAAI,OAAO,CAAC,eAAZ,EAA6B;AAC3B,QAAA,UAAU,CAAC,QAAD,EAAW,CAAX,EAAc,GAAd,CAAV;AACD,OAFD,MAEO;AACL,QAAA,UAAU,CAAC,QAAD,EAAW,CAAX,CAAV;AACD;AACF,KAND;;AAQA;AACA,IAAA,OAAO,CAAC,KAAR,CAAc,MAAd,EAAsB,IAAtB,EAA4B,IAA5B,EAAkC,IAAlC,CAAuC,YAAvC,EAAqD,UAArD;AACA;AACD,GAtCD;;AAwCA,EAAA,MAAM,CAAC,cAAP,CAAsB,EAAtB,EAA0B,MAAM,CAAC,cAAP,CAAsB,MAAtB,CAA1B;AACA,EAAA,MAAM,CAAC,gBAAP,CAAwB,EAAxB,EAA4B,MAAM,CAAC,yBAAP,CAAiC,MAAjC,CAA5B;;AAEA,SAAO,EAAP;AACD,CAvDM,C","file":"callbackify.js","sourcesContent":["import _ from 'lodash';\n\nimport {\n  AsyncFn,\n  CallbackFn\n} from '../types';\n\n// NOTE follows closely Node.js util.callbackify\n\n/**\n * Part of `lodash-firecloud`.\n *\n * Convert Promise into callback-like function.\n *\n * @param origFn Promise to callbackify.\n * @param options Options object.\n * @param [options.callbackFirst=false] Specifies if callback is a first arg.\n * @param [options.errorInCallback=true] Specifies if the first arg of callback is an error.\n * @param [options.keepCallback=false] Specifies if the callback arg should be passed to the Promise.\n * @returns Returns a callback-like function wrapping original `fn`.\n */\nexport let callbackify = function(origFn: AsyncFn, options: {\n  callbackFirst?: boolean;\n  errorInCallback?: boolean;\n  keepCallback?: boolean;\n} = {}): CallbackFn {\n  _.defaults(options, {\n    callbackFirst: false,\n    errorInCallback: true,\n    keepCallback: false\n  });\n\n  let fn = function(...args): void {\n    let origCallback;\n    if (options.callbackFirst) {\n      origCallback = _.head(args);\n      if (!options.keepCallback) {\n        args.shift();\n      }\n    } else {\n      origCallback = _.last(args);\n      if (!options.keepCallback) {\n        args.pop();\n      }\n    }\n    let callback = (...args): void => {\n      // eslint-disable-next-line babel/no-invalid-this\n      Reflect.apply(origCallback, this, args);\n      // origCallback(...args);\n    };\n\n    let onFullfilled = function(result): void {\n      if (options.errorInCallback) {\n        setTimeout(callback, 0, undefined, result);\n      } else {\n        setTimeout(callback, 0, result);\n      }\n    };\n\n    let onRejected = function(err): void {\n      if (options.errorInCallback) {\n        setTimeout(callback, 0, err);\n      } else {\n        setTimeout(callback, 0);\n      }\n    };\n\n    // eslint-disable-next-line babel/no-invalid-this\n    Reflect.apply(origFn, this, args).then(onFullfilled, onRejected);\n    // origFn(...args).then(onFullfilled, onRejected);\n  };\n\n  Object.setPrototypeOf(fn, Object.getPrototypeOf(origFn));\n  Object.defineProperties(fn, Object.getOwnPropertyDescriptors(origFn));\n\n  return fn;\n};\n"]}